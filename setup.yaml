---
  - name: "Setup for the GOOMBA bot."
    hosts: localhost
    connection: local
    become: yes
    tasks:
    - name: Find out playbook's path
      shell: pwd
      register: playbook_path_output
    - debug: var=playbook_path_output.stdout
    - name: "Install dependencies for voice chat support."
      apt:
        pkg:
          - libffi-dev
          - libnacl-dev
          - python3-dev
        state: latest
        update_cache: true
    - name: "Create venv with required modules."
      pip:
        requirements: "{{ playbook_path_output.stdout }}/requirements.txt"
        virtualenv: "{{ playbook_path_output.stdout }}/.venv"
        virtualenv_python: python3
    - name: "Create a *.txt file with a token inside of it."
      copy:
        content: "{{ BOT_TOKEN }}"
        dest: "{{ playbook_path_output.stdout }}/token.txt"
    - name: "Create a shell script for running the bot"
      copy:
        content: ".venv/bin/python3 main.py"
        dest: "{{ playbook_path_output.stdout }}/run.sh"
        mode: u=rwx,g=rwx,o=rwx
      